//Dependencias
var HTTP = require('http');
var FileSystem = require('fs');
var url = require('url'); //ayuda a tener la url en variable
//Crear el serer HTTP
var server = HTTP.createServer(function(request,response){
//Construccion y parseo de la URL
  var uri = (request.connection.encrypted?'https':'http')+'://'+request.headers.host+request.url;
  var uri_parseada = url.parse(uri,true);
  console.log('uri: '+uri);
  console.log('uri_parseada: '+uri_parseada);

    //GET y ruta/ --> página1   //POST y ruta/ --> página2
    if(request.method == "GET"){//pagina1.html
      if(uri_parseada.patch=="/"){
        FileSystem.readFile('pagina1.html',function(error,data){//Manda a llamar a hola.html
          console.log('Usuario conectado a: '+ request.url + 'mandando página1');
          //console.log(request); //request contiene todos los datos relacionados al dispositivo del usuario
          response.writeHead(200,"Content-Type:text/html"); //Manda un codigo 200 de OK
          response.write(data);
          response.end();
        });//Falta el manejo de errores
      }else{
        if(uri_parseada.patch == "/mensaje"){//Recurso.json
          FileSystem.readFile('recurso.json',function(error,data){//Manda a llamar a hola.html
            console.log('Usuario conectado a: '+ request.url + 'mandando recuso.json');
            //console.log(request); //request contiene todos los datos relacionados al dispositivo del usuario
            response.writeHead(200,"Content-Type:text/json"); //Manda un codigo 200 de OK
            response.write(data);
            response.end();
          });//Falta el manejo de errores
        }
      }
    }else{
      if(request.method == "POST"){//pagina2.html
        FileSystem.readFile('pagina2.html',function(error,data){//Manda a llamar a hola.html
          console.log('Usuario conectado a: '+ request.url  + 'mandando página2');
          //console.log(request); //request contiene todos los datos relacionados al dispositivo del usuario
          response.writeHead(200,"Content-Type:text/html"); //Manda un codigo 200 de OK
          response.write(data);
          response.end();
          });
      }else{
        response.writeHead(404,"Content-Type:text/html"); //Manda un codigo 404
        response.write('Solo acepto GET y POST');
        response.end();
      }
    }
});

server.listen(3000,function(){ //Primer parámetro = puerto
  console.log('Escuchando en puerto 3000');
});
